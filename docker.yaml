# Use a base image with required dependencies
FROM ubuntu:latest

# Install necessary system packages
RUN apt-get update && apt-get install -y \
    wget=1.20.3-1ubuntu1 \
    build-essential=12.8ubuntu1.1 \
    zlib1g-dev=1:1.2.11.dfsg-2ubuntu1.2 \
    libncurses5-dev=6.2-1ubuntu2 \
    libbz2-dev=1.0.8-2 \
    liblzma-dev=5.2.5-1.0ubuntu1 \
    libcurl4-openssl-dev=7.68.0-1ubuntu2.7 \
    libssl-dev=1.1.1f-1ubuntu2.10 \
    libxml2-dev=2.9.10+dfsg-5ubuntu0.20.04.2 \
    libz-dev=1:1.2.11.dfsg-2ubuntu1.2 \
    python3=3.8.10-0ubuntu1~20.04 \
    python3-pip=20.0.2-5ubuntu1.6 \
    r-base=4.0.4-1ubuntu1 \
    default-jre=2:1.11-72 \
    default-jdk=2:1.11-72 \
    bowtie=1.2.3+dfsg-3 \
    bowtie2=2.3.5.1-6 \
    bwa=0.7.17-6 \
    bedtools=2.29.2+dfsg-4 && \
    rm -rf /var/lib/apt/lists/*

# Install Python libraries
RUN pip3 install bs4==0.0.1 urllib3==1.26.7 regex==2021.8.28

# Install Snakemake
RUN pip3 install snakemake==6.10.0

# Install STAR
RUN wget https://github.com/alexdobin/STAR/archive/2.7.9a.tar.gz && \
    tar -xzf 2.7.9a.tar.gz && \
    cd STAR-2.7.9a && \
    make && \
    cp -r bin/Linux_x86_64_static/* /usr/local/bin/

# Install Kallisto
RUN wget https://github.com/pachterlab/kallisto/releases/download/v0.46.2/kallisto_linux-v0.46.2.tar.gz && \
    tar -xzf kallisto_linux-v0.46.2.tar.gz && \
    cp kallisto_linux-v0.46.2/kallisto /usr/local/bin/

# Set environment variables
ENV PATH="/usr/local/bin:${PATH}"

# Set working directory
WORKDIR /workspace

# Set default command
CMD ["bash"]
